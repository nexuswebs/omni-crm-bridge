
# CRM Inteligente - Sistema Completo

## Vis√£o Geral

Sistema CRM completo com integra√ß√£o WhatsApp, automa√ß√µes n8n, intelig√™ncia artificial e processamento de pagamentos. Desenvolvido com React, TypeScript e integra√ß√£o com Evolution API e n8n.cloud.

**URL do Projeto**: https://lovable.dev/projects/e1db57eb-cf13-4ddc-8ee4-ebd755cd3218

## Caracter√≠sticas Principais

- üöÄ **Dashboard Inteligente** com m√©tricas em tempo real
- üë• **Gest√£o Completa de Clientes** com hist√≥rico detalhado
- üí¨ **WhatsApp Business Integration** via Evolution API
- ü§ñ **Automa√ß√µes Avan√ßadas** com n8n.cloud
- üß† **Intelig√™ncia Artificial** OpenAI para respostas autom√°ticas
- üí≥ **Processamento de Pagamentos** Stripe/PIX
- üìä **Analytics e Relat√≥rios** detalhados
- üîê **Sistema de Usu√°rios** com diferentes n√≠veis de acesso

## Tecnologias Utilizadas

- **Frontend**: React 18, TypeScript, Tailwind CSS
- **UI Components**: shadcn/ui, Radix UI
- **Roteamento**: React Router DOM
- **Estado**: React Query (TanStack)
- **Build**: Vite
- **Banco de Dados**: MySQL/MariaDB
- **Backend**: Node.js + Express
- **Integra√ß√µes**: Evolution API, n8n.cloud, OpenAI, Stripe

## Pr√©-requisitos

### Servidor Principal (cPanel/CloudLinux)
- cPanel com CloudLinux
- Node.js 18+ (via Node.js Selector)
- MySQL 5.7+ ou MariaDB 10.2+
- SSL/TLS configurado
- Dom√≠nio ou subdom√≠nio

### VPS Evolution API (Separada)
- Ubuntu 20.04+ ou CentOS 8+
- Node.js 18+
- Docker (opcional)
- 2GB RAM m√≠nimo
- 20GB SSD m√≠nimo

### Contas de Servi√ßos Externos
- [n8n.cloud](https://n8n.cloud) - Automa√ß√µes
- [OpenAI](https://platform.openai.com) - Intelig√™ncia Artificial
- [Stripe](https://stripe.com) - Pagamentos (opcional)

## Instala√ß√£o Completa

### 1. Configura√ß√£o do Servidor Principal (cPanel)

#### 1.1 Preparar Banco de Dados
1. Acesse **MySQL Databases** no cPanel
2. Crie banco: `seu_usuario_crm_database`
3. Crie usu√°rio: `seu_usuario_crm_user` com senha forte
4. Adicione usu√°rio ao banco com todas as permiss√µes
5. Acesse **phpMyAdmin** e importe `database/crm_structure.sql`

#### 1.2 Configurar Node.js
1. Acesse **Node.js Selector** no cPanel
2. Clique em **Create Application**:
   - Node.js version: 18.x ou superior
   - Application mode: Production
   - Application root: `crm-system`
   - Application URL: seu dom√≠nio
   - Application startup file: `server.js`

#### 1.3 Upload e Instala√ß√£o
1. Via **File Manager** ou FTP, envie todos os arquivos para `/public_html/crm-system/`
2. No terminal do cPanel ou SSH:
```bash
cd public_html/crm-system
npm install
npm run build
```

#### 1.4 Configurar servidor Express
Crie `server.js` na raiz:
```javascript
const express = require('express');
const path = require('path');
const cors = require('cors');

const app = express();

app.use(cors());
app.use(express.json());
app.use(express.static(path.join(__dirname, 'dist')));

app.get('/api/health', (req, res) => {
  res.json({ status: 'OK', timestamp: new Date().toISOString() });
});

app.get('*', (req, res) => {
  res.sendFile(path.join(__dirname, 'dist', 'index.html'));
});

const port = process.env.PORT || 3000;
app.listen(port, () => {
  console.log(`CRM rodando na porta ${port}`);
});
```

### 2. Configura√ß√£o Evolution API (VPS Separada)

#### 2.1 Preparar Servidor VPS
```bash
# Atualizar sistema
sudo apt update && sudo apt upgrade -y

# Instalar Node.js 18
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# Instalar PM2 para gerenciamento
sudo npm install -g pm2
```

#### 2.2 Instalar Evolution API
```bash
# Clonar reposit√≥rio
git clone https://github.com/EvolutionAPI/evolution-api.git
cd evolution-api

# Instalar depend√™ncias
npm install

# Configurar ambiente
cp .env.example .env
```

#### 2.3 Configurar Evolution API
Edite o arquivo `.env`:
```env
# Servidor
SERVER_TYPE=http
SERVER_PORT=8080
CORS_ORIGIN=*
CORS_METHODS=GET,POST,PUT,DELETE
CORS_CREDENTIALS=true

# Autentica√ß√£o
AUTHENTICATION_TYPE=apikey
AUTHENTICATION_API_KEY=SUA_CHAVE_SECRETA_AQUI

# Database
DATABASE_ENABLED=true
DATABASE_CONNECTION_URI=mongodb://localhost:27017/evolution
# ou use PostgreSQL:
# DATABASE_CONNECTION_URI=postgresql://user:pass@localhost:5432/evolution

# Redis (opcional, para performance)
REDIS_ENABLED=false

# Webhook
WEBHOOK_GLOBAL_ENABLED=true
WEBHOOK_GLOBAL_URL=https://seu-crm-domain.com/api/webhook/whatsapp

# Inst√¢ncias
INSTANCE_EXPIRATION_TIME=false
DEL_INSTANCE=false

# Logs
LOG_LEVEL=ERROR
LOG_COLOR=true
```

#### 2.4 Instalar MongoDB
```bash
# Instalar MongoDB
wget -qO - https://www.mongodb.org/static/pgp/server-6.0.asc | sudo apt-key add -
echo "deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu focal/mongodb-org/6.0 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-6.0.list
sudo apt-get update
sudo apt-get install -y mongodb-org

# Iniciar MongoDB
sudo systemctl start mongod
sudo systemctl enable mongod
```

#### 2.5 Iniciar Evolution API
```bash
# Iniciar com PM2
pm2 start npm --name "evolution-api" -- start

# Configurar auto-start
pm2 startup
pm2 save

# Verificar status
pm2 status
```

#### 2.6 Configurar Firewall
```bash
# Permitir porta 8080
sudo ufw allow 8080
sudo ufw allow 22
sudo ufw enable
```

### 3. Configura√ß√£o n8n.cloud

#### 3.1 Criar Conta
1. Acesse [n8n.cloud](https://n8n.cloud)
2. Crie uma conta gratuita ou paga
3. Crie um novo workflow

#### 3.2 Configurar Webhook Principal
1. No n8n.cloud, adicione um n√≥ **Webhook**
2. Configure:
   - HTTP Method: `POST`
   - Path: `crm-webhook`
   - Response: `Immediately`
3. Copie a URL do webhook (ex: `https://sua-instancia.n8n.cloud/webhook/crm-webhook`)

#### 3.3 Configurar Integra√ß√µes
1. **WhatsApp Integration**:
   - Adicione n√≥ **HTTP Request**
   - URL: `http://SEU_VPS_IP:8080/instance/create`
   - Headers: `apikey: SUA_CHAVE_API`

2. **CRM Integration**:
   - Adicione n√≥ **HTTP Request** 
   - URL: `https://seu-crm-domain.com/api/webhook/n8n`

3. **OpenAI Integration**:
   - Adicione n√≥ **OpenAI**
   - API Key: Sua chave OpenAI

### 4. Configura√ß√£o Final do CRM

#### 4.1 Vari√°veis de Ambiente
Crie `.env` na raiz do CRM:
```env
# Sistema
NODE_ENV=production
PORT=3000
APP_URL=https://seu-crm-domain.com

# Banco de Dados
DB_HOST=localhost
DB_PORT=3306
DB_NAME=seu_usuario_crm_database
DB_USER=seu_usuario_crm_user
DB_PASSWORD=sua_senha_segura

# Evolution API (VPS Separada)
WHATSAPP_API_URL=http://SEU_VPS_IP:8080
WHATSAPP_API_KEY=SUA_CHAVE_SECRETA_AQUI
WHATSAPP_WEBHOOK_URL=https://seu-crm-domain.com/api/webhook/whatsapp

# n8n.cloud
N8N_WEBHOOK_URL=https://sua-instancia.n8n.cloud/webhook/crm-webhook
N8N_API_URL=https://sua-instancia.n8n.cloud/api/v1
N8N_API_KEY=sua_chave_api_n8n

# OpenAI
OPENAI_API_KEY=sk-sua_chave_openai
OPENAI_MODEL=gpt-3.5-turbo
OPENAI_MAX_TOKENS=500

# Stripe (opcional)
STRIPE_PUBLIC_KEY=pk_live_sua_chave_publica
STRIPE_SECRET_KEY=sk_live_sua_chave_secreta
STRIPE_WEBHOOK_SECRET=whsec_seu_webhook_secret

# Seguran√ßa
JWT_SECRET=seu_jwt_secret_muito_seguro
SESSION_SECRET=sua_session_secret_segura
```

#### 4.2 Configurar SSL/HTTPS
```bash
# No cPanel, v√° para SSL/TLS > Let's Encrypt
# Ou adicione no .htaccess:
RewriteEngine On
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
```

#### 4.3 Iniciar Aplica√ß√£o
```bash
# No Node.js Selector do cPanel:
# 1. Adicione as vari√°veis de ambiente
# 2. Clique em "Restart"
# 3. Verifique se est√° rodando
```

## Credenciais Padr√£o

Ap√≥s a instala√ß√£o, use estas credenciais para primeiro acesso:

- **Email**: `admin@crm.com`
- **Senha**: `password`

‚ö†Ô∏è **IMPORTANTE**: Altere a senha imediatamente ap√≥s o primeiro login!

## Configura√ß√£o P√≥s-Instala√ß√£o

### 1. Primeiro Acesso
1. Acesse: `https://seu-crm-domain.com`
2. Fa√ßa login com as credenciais padr√£o
3. Altere a senha em Perfil > Alterar Senha

### 2. Configurar Integra√ß√µes
1. V√° para **Configura√ß√µes > Integra√ß√µes**
2. Configure cada integra√ß√£o:

#### WhatsApp Evolution API:
- URL da API: `http://SEU_VPS_IP:8080`
- API Key: `SUA_CHAVE_SECRETA_AQUI`
- Teste a conex√£o

#### n8n.cloud:
- Webhook URL: `https://sua-instancia.n8n.cloud/webhook/crm-webhook`
- API URL: `https://sua-instancia.n8n.cloud/api/v1`
- API Key: `sua_chave_api_n8n`

#### OpenAI:
- API Key: `sk-sua_chave_openai`
- Modelo: `gpt-3.5-turbo`
- Max Tokens: `500`

### 3. Conectar WhatsApp
1. V√° para **WhatsApp > Conectar Inst√¢ncia**
2. Crie uma nova inst√¢ncia
3. Escaneie o QR Code com WhatsApp Business
4. Aguarde confirma√ß√£o de conex√£o

### 4. Criar Primeiro Workflow
1. V√° para **Workflows > Templates**
2. Escolha "Onboarding Autom√°tico"
3. Personalize conforme necess√°rio
4. Ative o workflow

## Monitoramento e Manuten√ß√£o

### Logs do Sistema
```bash
# CRM logs
tail -f /home/usuario/logs/crm-system.log

# Evolution API logs
pm2 logs evolution-api

# n8n logs dispon√≠veis no dashboard n8n.cloud
```

### Backup Autom√°tico
Configure no cPanel > Cron Jobs:
```bash
# Backup di√°rio √†s 3h
0 3 * * * cd /home/usuario && ./backup-crm.sh
```

### Monitoramento de Recursos
```bash
# Verificar status
cd /home/usuario/public_html/crm-system
node -e "console.log('CRM Status: OK')"

# VPS Evolution API
pm2 status
systemctl status mongod
```

## Solu√ß√£o de Problemas

### CRM n√£o carrega
1. Verificar logs: `tail -f logs/crm-system.log`
2. Verificar Node.js Selector est√° ativo
3. Testar: `curl https://seu-crm-domain.com/api/health`

### WhatsApp n√£o conecta
1. Verificar VPS Evolution API: `pm2 status`
2. Testar API: `curl http://SEU_VPS_IP:8080/instance/fetchInstances`
3. Verificar firewall: `sudo ufw status`

### n8n workflows n√£o executam
1. Verificar webhook URL no n8n.cloud
2. Testar webhook manualmente
3. Verificar logs no dashboard n8n.cloud

### Banco de dados
```sql
-- Verificar conex√£o
SHOW TABLES;

-- Verificar usu√°rio admin
SELECT * FROM users WHERE email = 'admin@crm.com';

-- Reset senha admin se necess√°rio
UPDATE users SET password = '$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi' WHERE email = 'admin@crm.com';
```

## Estrutura do Projeto

```
crm-system/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ components/          # Componentes React
‚îÇ   ‚îú‚îÄ‚îÄ pages/              # P√°ginas da aplica√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ contexts/           # Contextos React
‚îÇ   ‚îú‚îÄ‚îÄ hooks/              # Custom hooks
‚îÇ   ‚îî‚îÄ‚îÄ lib/                # Utilit√°rios
‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îî‚îÄ‚îÄ crm_structure.sql   # Estrutura do banco
‚îú‚îÄ‚îÄ server.js               # Servidor Express
‚îú‚îÄ‚îÄ .env                    # Vari√°veis de ambiente
‚îî‚îÄ‚îÄ README.md              # Este arquivo
```

## Arquitetura do Sistema

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   CRM Frontend  ‚îÇ    ‚îÇ   CRM Backend    ‚îÇ    ‚îÇ   MySQL DB      ‚îÇ
‚îÇ   (React)       ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ   (Node.js)      ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ   (cPanel)      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                       ‚îÇ
         ‚ñº                       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   n8n.cloud     ‚îÇ    ‚îÇ  Evolution API   ‚îÇ
‚îÇ   (Workflows)   ‚îÇ    ‚îÇ  (VPS Separada)  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                       ‚îÇ
         ‚ñº                       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   OpenAI API    ‚îÇ    ‚îÇ   WhatsApp       ‚îÇ
‚îÇ   (IA)          ‚îÇ    ‚îÇ   Business       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## Custos Estimados (Mensais)

- **cPanel/CloudLinux**: R$ 30-80 (hospedagem)
- **VPS Evolution API**: R$ 20-50 (1-2GB RAM)
- **n8n.cloud**: $0-20 (dependendo do plano)
- **OpenAI API**: $5-50 (conforme uso)
- **Dom√≠nio**: R$ 15-30/ano
- **Total**: ~R$ 70-200/m√™s

## Licen√ßa e Suporte

- **Licen√ßa**: MIT
- **Suporte**: suporte@empresa.com
- **Documenta√ß√£o**: [Link para docs]
- **Comunidade**: [Discord/Telegram]

## Atualiza√ß√µes

Para atualizar o sistema:
1. Fa√ßa backup completo
2. Baixe nova vers√£o
3. Execute `npm install && npm run build`
4. Reinicie aplica√ß√£o

## Contribui√ß√£o

1. Fork o projeto
2. Crie branch para feature (`git checkout -b feature/nova-feature`)
3. Commit mudan√ßas (`git commit -am 'Add nova feature'`)
4. Push para branch (`git push origin feature/nova-feature`)
5. Abra Pull Request

---

**Desenvolvido com ‚ù§Ô∏è para automatizar e potencializar seu neg√≥cio**
